<?xml version="1.0" encoding="windows-1252" ?>
<!--Ant buildfile generated by Oracle JDeveloper-->
<!--Generated Sep 18, 2006 5:10:10 PM-->
<project name="EjbModule" default="all" basedir=".">
  <import file="../../Chapter01-GettingStarted/build.xml"/>
  <property file="../../Chapter01-GettingStarted/build.properties"/>
  
  <target name="all" description="Build the EjbModule project"
          depends="init,clean,compile,copy,DropAndCreateTables,Assemble-EjbModule,Assemble-EjbModuleClient,Deploy-EjbModule"/>

  <target name="init">
    <tstamp/>
    <mkdir dir="${output.dir}"/>
    <mkdir dir="${assemble.dir}"/>
  </target>
  
  <target name="clean" description="Clean the project" depends="init">
    <delete includeemptydirs="true" quiet="true">
      <fileset dir="${output.dir}" includes="**/*"/>
      <fileset dir="${assemble.dir}" includes="**/*"/>
    </delete>
  </target>
  
  <path id="compile.path">
    <pathelement location="${glassfish_home}/lib/javaee.jar"/>
    <pathelement location="${glassfish_home}/lib/toplink-essentials.jar"/>
  </path>

  <target name="compile" description="Compile Java source files" depends="init,clean">
    <javac destdir="${output.dir}"
           classpathref="compile.path"
           debug="${javac.debug}" nowarn="${javac.nowarn}"
           deprecation="${javac.deprecation}" encoding="Cp1252" source="1.5"
           target="1.5">
      <src path="src"/>
    </javac>
  </target>

  <target name="copy" description="Copy files to output directory"
          depends="init">
    <patternset id="copy.patterns">
      <include name="META-INF/*"/>
    </patternset>
    <copy todir="${output.dir}">
      <fileset dir="src">
        <patternset refid="copy.patterns"/>
      </fileset>
    </copy>
  </target>

  <!-- Drop and create database objects for the context project -->
  <target name="DropAndCreateTables" depends="init">
    <sql rdbms="oracle" driver="oracle.jdbc.OracleDriver"
         userid="${jdbc.username}" password="${jdbc.password}"
         url="${jdbc.url}"
         classpath="${glassfish_home}/lib/ojdbc14.jar"
         onerror="continue">
      <transaction src="database/${ant.project.name}.sql"></transaction>
    </sql>
  </target>
  
  <target name="Assemble-EjbModule" depends="init">
    <mkdir dir="${assemble.dir}"/>
    <jar destfile="${assemble.dir}/${ant.project.name}.jar" update="true">
      <fileset dir="${output.dir}" casesensitive="yes">
        <include name="com/apress/ejb3/**/*.class"/>
        <include name="META-INF/*"/>
        <exclude name="com/apress/ejb3/**/client/*"/>
        <exclude name="META-INF/application-client*"/>
      </fileset>
    </jar>
    <echo>Created persistence unit archive ${assemble.dir}/${ant.project.name}.jar</echo>
  </target>
  
  <target name="Assemble-EjbModuleClient" depends="init">
    <mkdir dir="${assemble.dir}"/>
    <jar destfile="${assemble.dir}/${ant.project.name}Client.jar" update="true">
      <fileset dir="${output.dir}" casesensitive="yes">
        <include name="com/apress/ejb3/**/*.class"/>
        <include name="META-INF/*"/>
        <exclude name="com/apress/ejb3/**/client/*"/>
        <exclude name="com/apress/ejb3/**/CustomerOrderManager.java"/>
      </fileset>
    </jar>
    <echo>Created persistence unit archive ${assemble.dir}/${ant.project.name}Client.jar</echo>
  </target>
  
  <target name="Undeploy-EjbModule" depends="init" unless="ee">
    <echo message="Un-deploying EJB module ${ant.project.name}"
          level="verbose"></echo>
    <echo message="asadmin.bat undeploy --user ${admin.user} --password ${admin.password} --host ${admin.host} --port ${admin.port} ${ant.project.name}"></echo>
    <exec executable="${glassfish_home}/bin/${ASADMIN}" failonerror="false">
      <arg line=" undeploy"/>
      <arg line="--user ${admin.user}"/>
      <arg line="--passwordfile ${glassfish_home}/asadminpass"/>
      <arg line="--host ${admin.host}"/>
      <arg line="--port ${admin.port}"/>
      <arg line="--target ${appserver.instance}"/>
      <arg line="{ant.project.name}"/>
    </exec>
  </target>
  
  <target name="Deploy-EjbModule" depends="init,Undeploy-EjbModule"
          unless="ee">
    <echo message="Deploying EJB module ${assemble.dir}/${ant.project.name}.jar containing the sample persistence unit"
          level="verbose"></echo>
    <echo message="asadmin.bat deploy --user ${admin.user} --password ${admin.password} --host ${admin.host} --port ${admin.port} --upload=true --target ${appserver.instance} ${assemble.dir}/${ant.project.name}.jar"></echo>
    <exec executable="${glassfish_home}/bin/${ASADMIN}" failonerror="false">
      <arg line=" deploy"/>
      <arg line="--user ${admin.user}"/>
      <arg line="--passwordfile ${glassfish_home}/asadminpass"/>
      <arg line="--host ${admin.host}"/>
      <arg line="--port ${admin.port}"/>
      <arg line="--upload=true"/>
      <arg line="--target ${appserver.instance}"/>
      <arg line="${assemble.dir}/${ant.project.name}.jar"/>
    </exec>
  </target>
</project>
