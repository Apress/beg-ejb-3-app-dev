<?xml version="1.0" encoding="windows-1252" ?>
<!--Ant buildfile generated by Oracle JDeveloper-->
<!--Generated Sep 18, 2006 5:10:10 PM-->
<project name="Setup" default="all" basedir=".">
  <import file="../Chapter01-GettingStarted/build.xml"/>
  <property file="../../Chapter01-GettingStarted/build.properties"/>
  
  <target name="all" description="Build the project"
          depends="init,clean,compile,copy,DropAndCreateTables,Assemble-PersistenceUnit,Run-EntityClient"/>

  <target name="init">
    <tstamp/>
    <mkdir dir="${output.dir}"/>
    <mkdir dir="${assemble.dir}"/>
  </target>
  
  <target name="clean" description="Clean the project" depends="init">
    <delete includeemptydirs="true" quiet="true">
      <fileset dir="${output.dir}" includes="**/*"/>
      <fileset dir="${assemble.dir}" includes="**/*"/>
    </delete>
  </target>

  <target name="compile" description="Compile Java source files" depends="init">
    <javac destdir="${output.dir}"
           classpath="${glassfish_home}/lib/toplink-essentials.jar"
           debug="${javac.debug}" nowarn="${javac.nowarn}"
           deprecation="${javac.deprecation}" encoding="Cp1252" source="1.5"
           target="1.5">
      <src path="src"/>
    </javac>
  </target>

  <target name="copy" description="Copy files to output directory"
          depends="init">
    <patternset id="copy.patterns">
      <include name="**/persistence.xml"/>
    </patternset>
    <copy todir="${output.dir}">
      <fileset dir="src">
        <patternset refid="copy.patterns"/>
      </fileset>
    </copy>
  </target>

  <!-- Drop and create database objects for the context project -->
  <target name="DropAndCreateTables" depends="init">
    <sql rdbms="oracle" driver="oracle.jdbc.OracleDriver"
         userid="${jdbc.username}" password="${jdbc.password}"
         url="${jdbc.url}"
         classpath="${glassfish_home}/lib/ojdbc14.jar"
         onerror="continue">
      <transaction src="database/${ant.project.name}.sql"></transaction>
    </sql>
  </target>

  <target name="Assemble-PersistenceUnit" depends="init">
    <mkdir dir="${assemble.dir}"/>
    <jar destfile="${assemble.dir}/${ant.project.name}.jar" update="true">
      <fileset dir="${output.dir}" casesensitive="yes">
        <include name="com/apress/ejb3/ch04/**/*.class"/>
        <include name="META-INF/persistence.xml"/>
        <exclude name="com/apress/ejb3/ch04/**/client/*"/>
      </fileset>
    </jar>
    <echo>Created persistence unit archive ${assemble.dir}/${ant.project.name}PersistenceUnit.jar</echo>
  </target>
  
  <path id="entityclient.path">
    <pathelement location="${output.dir}"/>
    <pathelement location="${assemble.dir}/${ant.project.name}PersistenceUnit.jar"/>
    <pathelement location="${glassfish_home}/lib/toplink-essentials.jar"/>
    <pathelement location="${glassfish_home}/lib/ant/lib/xercesImpl.jar"/>
    <pathelement location="${glassfish_home}/lib/ojdbc14.jar"/>
  </path>
  
  <target name="Run-EntityClient" depends="init">
    <echo message="Executing entity client and running the persistence unit outside the Java EE container"></echo>
    <echo message="|-- classpath"></echo>
    <echo message="|   |"></echo>
    <echo message="|   |-- ${echo.path.compile}"></echo>
    <java classname="com.apress.ejb3.ch04.${project.package}.client.EntityClient"
          classpathref="entityclient.path"></java>
  </target>

  <!-- get the source compile classpath in a printable form -->
  <pathconvert pathsep="${line.separator}|   |-- " property="echo.path.compile"
               refid="entityclient.path"></pathconvert>
</project>
